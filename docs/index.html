<!DOCTYPE html>
<html>
<head>
    <title>ìš´ì„ í”¼í•˜ê¸°</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: black;
        }
        .container {
            text-align: center;
        }
        #gameCanvas {
            border: 2px solid #333;
            background-color: #000033;
            cursor: none;
        }
        #score, #time {
            color: white;
            font-size: 24px;
            margin: 10px;
        }
        #pauseInfo {
            display: none;
            color: red;
            font-size: 30px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        .game-container {
            display: flex;
            gap: 20px;
            padding: 20px;
            background-color: #1a1a1a;
        }
        .preview-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-left: 20px;
        }
        .preview-box {
            width: auto;
            padding: 10px;
            background-color: #333;
            border-radius: 5px;
        }
        .preview-title {
            color: white;
            margin-bottom: 10px;
            font-size: 14px;
        }
        canvas {
            background-color: #000033;
        }
        #apiStatus {
            color: white;
            font-size: 14px;
            margin: 10px;
            padding: 5px;
            border-radius: 3px;
        }
        .api-ok {
            background-color: #4CAF50;
        }
        .api-error {
            background-color: #f44336;
        }
        #version {
            position: fixed;
            bottom: 10px;
            right: 10px;
            color: #666;
            font-size: 12px;
        }
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border: 2px solid #333;
            border-radius: 10px;
            color: white;
            text-align: center;
            z-index: 1000;
        }
        
        .modal-content {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .modal-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
        }
        
        .modal-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div>
            <div id="score">ì ìˆ˜: 0 (ë‹¨ê³„: 1)</div>
            <div id="time">ì‹œê°„: 0ms</div>
            <div id="apiStatus">API ìƒíƒœ: í™•ì¸ ì¤‘...</div>
            <canvas id="gameCanvas" width="400" height="600"></canvas>
        </div>
        <div class="preview-container">
            <div class="preview-box">
                <div class="preview-title">í­ë°œ ì´ë¯¸ì§€</div>
                <canvas id="previewCanvas" width="400" height="200"></canvas>
            </div>
            <div class="preview-box">
                <div class="preview-title">í­ë°œ ì• ë‹ˆë©”ì´ì…˜ ë¯¸ë¦¬ë³´ê¸°</div>
                <canvas id="animationCanvas" width="200" height="200"></canvas>
            </div>
        </div>
    </div>

    <div id="version">v1.0</div>

    <!-- ëª¨ë‹¬ ì¶”ê°€ -->
    <div id="gameOverModal" class="modal">
        <div class="modal-content" id="modalText"></div>
        <button class="modal-button" onclick="closeModal()">SPACEë¥¼ ëˆŒëŸ¬ ì¬ì‹œì‘</button>
    </div>

    <script>
        // DOM ìš”ì†Œ ì°¸ì¡° ì¶”ê°€
        const scoreElement = document.getElementById('score');
        const timeElement = document.getElementById('time');
        const apiStatusElement = document.getElementById('apiStatus');

        // ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const previewCanvas = document.getElementById('previewCanvas');
        const previewCtx = previewCanvas.getContext('2d');
        const animationCanvas = document.getElementById('animationCanvas');
        const animationCtx = animationCanvas.getContext('2d');

        // ê²Œì„ ìƒíƒœ ë³€ìˆ˜ë“¤
        let gameStarted = false;
        let isGameOver = false;
        let isPaused = false;
        let score = 0;
        let startTime;
        let meteors = [];
        let explosions = [];
        let highScore = localStorage.getItem('highScore') || 0;
        let highScoreTime = localStorage.getItem('highScoreTime') || '0.000';

        // ì´ë¯¸ì§€ ë¡œë“œ
        const playerImage = new Image();
        const meteorImage = new Image();
        const explosionImage = new Image();

        // ì´ë¯¸ì§€ ë¡œë”© ìƒíƒœ ì²´í¬
        let imagesLoaded = {
            player: false,
            meteor: false,
            explosion: false
        };

        // ì´ë¯¸ì§€ ë¡œë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        playerImage.onload = () => {
            console.log('í”Œë ˆì´ì–´ ì´ë¯¸ì§€ ë¡œë“œë¨');
            imagesLoaded.player = true;
            checkStartGame();
        };

        meteorImage.onload = () => {
            console.log('ìš´ì„ ì´ë¯¸ì§€ ë¡œë“œë¨');
            imagesLoaded.meteor = true;
            checkStartGame();
        };

        explosionImage.onload = () => {
            console.log('í­ë°œ ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ:', {
                width: explosionImage.width,
                height: explosionImage.height,
                src: explosionImage.src
            });
            imagesLoaded.explosion = true;
            startExplosionPreview();
            checkStartGame();
        };

        // ì´ë¯¸ì§€ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        playerImage.onerror = (error) => {
            console.error('í”Œë ˆì´ì–´ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨. íŒŒì¼ ê²½ë¡œ í™•ì¸:', playerImage.src);
        };

        meteorImage.onerror = (error) => {
            console.error('ìš´ì„ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨. íŒŒì¼ ê²½ë¡œ í™•ì¸:', meteorImage.src);
        };

        explosionImage.onerror = (error) => {
            console.error('í­ë°œ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨. íŒŒì¼ ê²½ë¡œ í™•ì¸:', explosionImage.src);
        };

        // ëª¨ë“  ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
        function checkStartGame() {
            if (imagesLoaded.player && imagesLoaded.meteor) {
                console.log('í•„ìˆ˜ ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ');
                requestAnimationFrame(gameLoop);
            }
        }

        // ì´ë¯¸ì§€ ì†ŒìŠ¤ ì„¤ì • ìˆ˜ì •
        playerImage.src = './images/player.png';     // ìƒëŒ€ ê²½ë¡œë¡œ ìˆ˜ì •
        meteorImage.src = './images/meteor.png';     // ìƒëŒ€ ê²½ë¡œë¡œ ìˆ˜ì •
        explosionImage.src = './images/explosion.jpg'; // ìƒëŒ€ ê²½ë¡œë¡œ ìˆ˜ì •

        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // í­ë°œ ì• ë‹ˆë©”ì´ì…˜ í”„ë¦¬ë·°
        function startExplosionPreview() {
            let frame = 0;
            const frameWidth = explosionImage.width / 4;    // ì›ë³¸ í”„ë ˆì„ ë„ˆë¹„
            const frameHeight = explosionImage.height / 2;  // ì›ë³¸ í”„ë ˆì„ ë†’ì´
            const totalFrames = 8;
            const framesPerRow = 4;

            // ìŠ¤ì¼€ì¼ ê³„ì‚°
            const scale = 0.1;  // ì›ë³¸ í¬ê¸°ì˜ 10%ë¡œ ì¶•ì†Œ
            const scaledWidth = frameWidth * scale;
            const scaledHeight = frameHeight * scale;

            // ì „ì²´ ìŠ¤í”„ë¼ì´íŠ¸ ì‹œíŠ¸ í‘œì‹œ
            previewCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
            previewCtx.drawImage(
                explosionImage, 
                0, 
                0, 
                explosionImage.width,
                explosionImage.height,
                0,
                0,
                previewCanvas.width,
                previewCanvas.height
            );

            function animatePreview() {
                const row = Math.floor(frame / framesPerRow);
                const col = frame % framesPerRow;

                animationCtx.clearRect(0, 0, animationCanvas.width, animationCanvas.height);
                animationCtx.drawImage(
                    explosionImage,
                    col * frameWidth,
                    row * frameHeight,
                    frameWidth,
                    frameHeight,
                    0,
                    0,
                    animationCanvas.width,
                    animationCanvas.height
                );

                frame = (frame + 1) % totalFrames;
                setTimeout(() => requestAnimationFrame(animatePreview), 100);
            }

            animatePreview();
        }

        // ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë³µêµ¬
        canvas.addEventListener('mousemove', (e) => {
            if (!gameStarted || isGameOver || isPaused) return;
            
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            // í”Œë ˆì´ì–´ ì´ë™    
            player.x = mouseX - player.width/2;
            player.y = mouseY - player.height/2;

            // í™”ë©´ ê²½ê³„ ì²´í¬
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
            if (player.y < 0) player.y = 0;
            if (player.y > canvas.height - player.height) player.y = canvas.height - player.height;
        });

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìˆ˜ì •
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                if (!gameStarted && !isGameOver) {
                    gameStarted = true;
                    startTime = Date.now();
                    lastDifficultyIncrease = Date.now();
                    meteorCount = 1;
                    canvas.style.cursor = 'none';
                }
            }
        });

        // í”Œë ˆì´ì–´ ê°ì²´
        const player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 40,
            height: 40
        };

        function createMeteor() {
            const size = 30 + Math.random() * 40; // 30~70 ì‚¬ì´ì˜ ëœë¤ í¬ê¸°
            const meteor = {
                x: 0,
                y: 0,
                width: size,
                height: size,
                speedX: 0,
                speedY: 0,
                rotation: Math.random() * Math.PI * 2, // ì´ˆê¸° íšŒì „ ê°ë„
                rotationSpeed: (Math.random() - 0.5) * 0.2 // íšŒì „ ì†ë„
            };

            // ìš´ì„ ì‹œì‘ ìœ„ì¹˜ (í™”ë©´ ë°”ê¹¥)
            const side = Math.floor(Math.random() * 4);
            switch(side) {
                case 0: // ìœ„
                    meteor.x = Math.random() * canvas.width;
                    meteor.y = -meteor.height;
                    break;
                case 1: // ì˜¤ë¥¸ìª½
                    meteor.x = canvas.width + meteor.width;
                    meteor.y = Math.random() * canvas.height;
                    break;
                case 2: // ì•„ë˜
                    meteor.x = Math.random() * canvas.width;
                    meteor.y = canvas.height + meteor.height;
                    break;
                case 3: // ì™¼ìª½
                    meteor.x = -meteor.width;
                    meteor.y = Math.random() * canvas.height;
                    break;
            }

            // í”Œë ˆì´ì–´ ë°©í–¥ìœ¼ë¡œì˜ ì†ë„ ê³„ì‚°
            const angle = Math.atan2(
                player.y + player.height/2 - meteor.y,
                player.x + player.width/2 - meteor.x
            );
            const speed = 2 + Math.random() * 2; // 2~4 ì‚¬ì´ì˜ ëœë¤ ì†ë„
            meteor.speedX = Math.cos(angle) * speed;
            meteor.speedY = Math.sin(angle) * speed;

            meteors.push(meteor);
        }

        function checkCollision(player, meteor) {
            // ì¤‘ì‹¬ì  ê°„ì˜ ê±°ë¦¬ ê³„ì‚°
            const dx = (player.x + player.width/2) - (meteor.x + meteor.width/2);
            const dy = (player.y + player.height/2) - (meteor.y + meteor.height/2);
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // ì¶©ëŒ ë°˜ê²½ (ë‘ ê°ì²´ì˜ í¬ê¸°ë¥¼ ê³ ë ¤)
            const collisionRadius = (player.width + meteor.width) / 4;
            
            return distance < collisionRadius;
        }

        // ì‹œê°„ í‘œì‹œ í•¨ìˆ˜
        function getGameTime() {
            if (!startTime) return '0.000s';
            const ms = Date.now() - startTime;
            const seconds = (ms / 1000).toFixed(3); // ë°€ë¦¬ì´ˆë¥¼ ì´ˆë¡œ ë³€í™˜í•˜ê³  ì†Œìˆ˜ì  3ìë¦¬ê¹Œì§€ í‘œì‹œ
            return `${seconds}s`;
        }

        // ìš´ì„ ìƒì„± ê´€ë ¨ ë³€ìˆ˜ ì¶”ê°€
        let lastMeteorTime = 0;
        let meteorInterval = 1000; // ê¸°ë³¸ 1ì´ˆë§ˆë‹¤ ìš´ì„ ìƒì„±
        let meteorCount = 1;      // í•œ ë²ˆì— ìƒì„±í•  ìš´ì„ ìˆ˜
        let lastDifficultyIncrease = 0;
        const DIFFICULTY_INTERVAL = 10000; // 10ì´ˆë§ˆë‹¤ ë‚œì´ë„ ì¦ê°€

        // update í•¨ìˆ˜ ìˆ˜ì •
        function update() {
            if (!gameStarted || isGameOver || isPaused) return;

            const currentTime = Date.now();

            // 10ì´ˆë§ˆë‹¤ ë‚œì´ë„ ì¦ê°€
            if (currentTime - lastDifficultyIncrease >= DIFFICULTY_INTERVAL) {
                meteorCount++;
                lastDifficultyIncrease = currentTime;
                console.log(`ë‚œì´ë„ ì¦ê°€! í˜„ì¬ ìš´ì„ ìˆ˜: ${meteorCount}, ì‹œê°„: ${getGameTime()}`);
                scoreElement.textContent = `ì ìˆ˜: ${score} (ë‹¨ê³„: ${meteorCount})`;
            }

            // ìš´ì„ ìƒì„± íƒ€ì´ë° ì²´í¬
            if (currentTime - lastMeteorTime > meteorInterval) {
                // í•œ ë²ˆì— ì—¬ëŸ¬ ê°œì˜ ìš´ì„ ìƒì„±
                for (let i = 0; i < meteorCount; i++) {
                    createMeteor();
                }
                lastMeteorTime = currentTime;
            }

            // ìš´ì„ ì—…ë°ì´íŠ¸
            meteors.forEach((meteor, index) => {
                meteor.x += meteor.speedX;
                meteor.y += meteor.speedY;
                meteor.rotation += meteor.rotationSpeed;

                // ì¶©ëŒ ì²´í¬
                if (checkCollision(player, meteor)) {
                    gameOver();
                    return;
                }

                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ìš´ì„ ì œê±°
                if (meteor.x < -meteor.width || 
                    meteor.x > canvas.width + meteor.width ||
                    meteor.y < -meteor.height || 
                    meteor.y > canvas.height + meteor.height) {
                    meteors.splice(index, 1);
                    score++;
                    scoreElement.textContent = `ì ìˆ˜: ${score} (ë‹¨ê³„: ${meteorCount})`;
                }
            });

            // ì‹œê°„ ì—…ë°ì´íŠ¸
            timeElement.textContent = `ì‹œê°„: ${getGameTime()}`;
        }

        const DEBUG_MODE = false;

        // ìƒë‹¨ì— ë²„ì „ ìƒìˆ˜ ì¶”ê°€
        const GAME_VERSION = 'v1.0';

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (!gameStarted) {
                ctx.fillStyle = 'white';
                ctx.font = '30px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ìš´ì„ í”¼í•˜ê¸°', canvas.width/2, canvas.height/2 - 60);
                
                // ê¸°ì¡´ í…ìŠ¤íŠ¸ë“¤
                ctx.textAlign = 'center';
                ctx.font = '20px Arial';
                ctx.fillText('ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”', canvas.width/2, canvas.height/2 + 20);
                return;
            }

            // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
            if (imagesLoaded.player) {
                ctx.drawImage(playerImage, player.x, player.y, player.width, player.height);
            }

            // ìš´ì„ ê·¸ë¦¬ê¸°
            meteors.forEach(meteor => {
                ctx.save();
                // ìš´ì„ì˜ ì¤‘ì‹¬ìœ¼ë¡œ ì´ë™
                ctx.translate(
                    meteor.x + meteor.width/2,
                    meteor.y + meteor.height/2
                );
                // íšŒì „
                ctx.rotate(meteor.rotation);
                
                // ìš´ì„ ê·¸ë¦¬ê¸°
                if (meteorImage.complete && meteorImage.naturalHeight !== 0) {
                    ctx.drawImage(
                        meteorImage,
                        -meteor.width/2,
                        -meteor.height/2,
                        meteor.width,
                        meteor.height
                    );
                } else {
                    // ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš° ëŒ€ì²´ ê·¸ë˜í”½
                    ctx.fillStyle = '#F40';
                    ctx.beginPath();
                    ctx.moveTo(-meteor.width/2, 0);
                    ctx.lineTo(0, -meteor.height/2);
                    ctx.lineTo(meteor.width/2, 0);
                    ctx.lineTo(0, meteor.height/2);
                    ctx.closePath();
                    ctx.fill();
                }
                
                ctx.restore();
            });

            if (DEBUG_MODE) {
                const margin = 10;
                ctx.strokeStyle = 'lime';
                ctx.lineWidth = 1;
                
                // í”Œë ˆì´ì–´ ì¶©ëŒ ì˜ì—­
                ctx.strokeRect(
                    player.x + margin, 
                    player.y + margin, 
                    player.width - (margin * 2), 
                    player.height - (margin * 2)
                );
                
                // ìš´ì„ ì¶©ëŒ ì˜ì—­
                meteors.forEach(meteor => {
                    ctx.strokeRect(
                        meteor.x + margin, 
                        meteor.y + margin, 
                        meteor.width - (margin * 2), 
                        meteor.height - (margin * 2)
                    );
                });
            }

            // í­ë°œ íš¨ê³¼ ê·¸ë¦¬ê¸°
            if (imagesLoaded.explosion && explosions.length > 0) {
                console.log('í™œì„±í™”ëœ í­ë°œ íš¨ê³¼:', explosions.length);  // ë””ë²„ê¹…ìš©
                explosions = explosions.filter(explosion => explosion.draw(ctx));
            }
        }

        function startGame() {
            gameStarted = true;
            isGameOver = false;
            isPaused = false;
            score = 0;
            meteors = [];
            startTime = Date.now();
            lastDifficultyIncrease = Date.now();
            scoreElement.textContent = 'ì ìˆ˜: 0 (ë‹¨ê³„: 1)';
            player.x = canvas.width / 2 - player.width / 2;
            player.y = canvas.height - 100;
            pauseInfo.style.display = 'none';
            gameLoop();
        }

        // ì´ˆê¸° í™”ë©´ ê·¸ë¦¬ê¸°
        draw();

        // í­ë°œ íš¨ê³¼ ê´€ë ¨ ë³€ìˆ˜ë“¤
        const EXPLOSION_FRAMES = 8;  // í­ë°œ ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ ìˆ˜
        const EXPLOSION_DURATION = 500;  // í­ë°œ ì§€ì† ì‹œê°„ (ë°€ë¦¬ì´ˆ)

        // í­ë°œ íš¨ê³¼ í´ë˜ìŠ¤ ë³µêµ¬
        class Explosion {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.frame = 0;
                this.totalFrames = 8;
                this.frameRate = 15;
                this.startTime = Date.now();
                this.size = 100;  // í­ë°œ í¬ê¸°
            }

            draw(ctx) {
                const elapsed = Date.now() - this.startTime;
                this.frame = Math.floor((elapsed / 1000) * this.frameRate);

                if (this.frame < this.totalFrames) {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    
                    // í­ë°œ ê·¸ë¦¬ê¸°
                    ctx.beginPath();
                    ctx.fillStyle = `rgba(255, ${255 * (1-this.frame/this.totalFrames)}, 0, ${1-this.frame/this.totalFrames})`;
                    
                    // í­ë°œ íŒŒí‹°í´
                    for (let i = 0; i < 12; i++) {
                        const angle = (i / 12) * Math.PI * 2;
                        const scale = 1 - this.frame/this.totalFrames;
                        const radius = this.size * (this.frame/this.totalFrames);
                        
                        ctx.save();
                        ctx.rotate(angle);
                        ctx.translate(radius, 0);
                        ctx.beginPath();
                        ctx.arc(0, 0, this.size/4 * scale, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                    }
                    
                    ctx.restore();
                    return true;
                }
                return false;
            }
        }

        // ê²Œì„ ì˜¤ë²„ í•¨ìˆ˜ ìˆ˜ì •
        async function gameOver() {
            isGameOver = true;
            const currentTime = getGameTime();
            const finalScore = score;

            // ì¦‰ì‹œ í­ë°œ íš¨ê³¼ ìƒì„±
            const explosion = new Explosion(
                player.x + player.width/2,
                player.y + player.height/2
            );
            explosion.size = 150;
            explosions.push(explosion);
            
            try {
                const scoreData = {
                    score: finalScore,
                    time: currentTime
                };
                
                // API í˜¸ì¶œì„ ë³‘ë ¬ë¡œ ì²˜ë¦¬
                const [response, highScoresResponse] = await Promise.all([
                    fetch('https://meteor-game-git-main-purestorys-projects.vercel.app/api/scores', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(scoreData)
                    }),
                    fetch('https://meteor-game-git-main-purestorys-projects.vercel.app/api/scores')
                ]);

                const highScores = await highScoresResponse.json();
                
                // ìµœê³  ì ìˆ˜ ë¹„êµ ë¡œì§ ìˆ˜ì •
                const isNewHighScore = !highScores.scores.length || highScores.scores[0]?.score <= finalScore;
                
                setTimeout(() => {
                    if (isNewHighScore) {
                        showModal(`ğŸ‰ ìƒˆë¡œìš´ ìµœê³  ê¸°ë¡!<br>ìµœì¢… ì ìˆ˜: ${finalScore}<br>ìƒì¡´ ì‹œê°„: ${currentTime}`);
                    } else {
                        const topScore = highScores.scores[0] || { score: 0, time: '0.000' };
                        showModal(`ê²Œì„ ì˜¤ë²„!<br>ìµœì¢… ì ìˆ˜: ${finalScore}<br>ìƒì¡´ ì‹œê°„: ${currentTime}<br><br>ìµœê³  ê¸°ë¡: ${topScore.score}ì  (${topScore.time})`);
                    }
                    gameStarted = false;
                    isGameOver = false;
                    resetGame();
                }, 300);
                
            } catch (error) {
                console.error('ì ìˆ˜ ì €ì¥ ì‹¤íŒ¨:', error);
                showModal(`ê²Œì„ ì˜¤ë²„!<br>ìµœì¢… ì ìˆ˜: ${finalScore}<br>ìƒì¡´ ì‹œê°„: ${currentTime}`);
                gameStarted = false;
                isGameOver = false;
                resetGame();
            }
        }

        // ê²Œì„ ì´ˆê¸°í™” í•¨ìˆ˜ ì¶”ê°€
        function resetGame() {
            score = 0;
            meteors = [];
            explosions = [];
            startTime = null;
            lastMeteorTime = 0;
            meteorCount = 1;
            lastDifficultyIncrease = Date.now();
            
            // í”Œë ˆì´ì–´ ìœ„ì¹˜ ì´ˆê¸°í™”
            player.x = canvas.width / 2 - player.width / 2;
            player.y = canvas.height - 100;

            // ì ìˆ˜ì™€ ì‹œê°„ ì´ˆê¸°í™”
            scoreElement.textContent = 'ì ìˆ˜: 0 (ë‹¨ê³„: 1)';
            timeElement.textContent = 'ì‹œê°„: 0.000s';
        }

        // ê²Œì„ ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
        canvas.width = 400;
        canvas.height = 600;

        // API ìƒíƒœ í™•ì¸ í•¨ìˆ˜
        async function checkApiStatus() {
            try {
                const response = await fetch('https://meteor-game-git-main-purestorys-projects.vercel.app/api/scores');
                if (response.ok) {
                    apiStatusElement.textContent = 'API ìƒíƒœ: ì •ìƒ';
                    apiStatusElement.className = 'api-ok';
                } else {
                    apiStatusElement.textContent = 'API ìƒíƒœ: ì˜¤ë¥˜ (ì‘ë‹µ ì‹¤íŒ¨)';
                    apiStatusElement.className = 'api-error';
                }
            } catch (error) {
                apiStatusElement.textContent = 'API ìƒíƒœ: ì˜¤ë¥˜ (ì—°ê²° ì‹¤íŒ¨)';
                apiStatusElement.className = 'api-error';
                console.error('API ì—°ê²° ì‹¤íŒ¨:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ API ìƒíƒœ í™•ì¸
        checkApiStatus();

        // 30ì´ˆë§ˆë‹¤ API ìƒíƒœ ì¬í™•ì¸
        setInterval(checkApiStatus, 30000);

        // ë²„ì „ ì •ë³´ ì—…ë°ì´íŠ¸ ìˆ˜ì •
        const isGitHubPages = window.location.hostname.includes('github.io');
        const packageJsonPath = isGitHubPages ? `/meteor-game/package.json?v=${Date.now()}` : './package.json';

        fetch(packageJsonPath)
            .then(response => response.json())
            .then(data => {
                document.getElementById('version').textContent = `v${data.version}`;
                console.log('ë¡œë“œëœ ë²„ì „:', data.version, 'ê²½ë¡œ:', packageJsonPath);
            })
            .catch(error => {
                console.error('ë²„ì „ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                const fallbackPath = `./package.json?v=${Date.now()}`;
                if (packageJsonPath !== fallbackPath) {
                    fetch(fallbackPath)
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById('version').textContent = `v${data.version}`;
                            console.log('ëŒ€ì²´ ê²½ë¡œì—ì„œ ë¡œë“œëœ ë²„ì „:', data.version);
                        })
                        .catch(err => console.error('ëŒ€ì²´ ê²½ë¡œë„ ì‹¤íŒ¨:', err));
                }
            });

        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ ì¶”ê°€
        function showModal(text) {
            const modal = document.getElementById('gameOverModal');
            document.getElementById('modalText').innerHTML = text;
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('gameOverModal').style.display = 'none';
        }

        // ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space' && document.getElementById('gameOverModal').style.display === 'block') {
                closeModal();
            }
        });
    </script>
</body>
</html> 